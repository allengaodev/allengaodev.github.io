<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preload" as="style" href='/scss/clean-blog-min.css'/>

    <meta name="description" content="&#x4F7F;&#x7528; Makefile &#x81EA;&#x52D5;&#x5316;&#x7DE8;&#x8B6F;&#x548C;&#x90E8;&#x7F72;-&#x5B78;&#x7FD2;&#x539F;&#x7406;&#x8207;&#x6D41;&#x7A0B;">

  <title>Makefile&#x76F8;&#x95DC;&#x8A9E;&#x6CD5;&#x5B78;&#x7FD2;-&#x57FA;&#x790E;&#x8A9E;&#x6CD5;</title>


  <link rel="canonical" href='https://blog.allengaodev.com/posts/gnu-makefile'>

      <link type="application/rss+xml" rel="alternate" title="&#x958B;&#x767C;&#x7A7A;&#x9593;" href="/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="&#x958B;&#x767C;&#x7A7A;&#x9593;" href="/feed.atom" />

  <meta name="application-name" content='Gao.Dev' />
  <meta name="msapplication-tooltip" content='Gao.Dev' />
  <meta name="msapplication-starturl" content='/' />
  <meta name="google-site-verification" content="aq71qXzppLuXZ8be8mjOwn_zJq317ZSD34yTS4i6y6M" />
  <meta property="og:title" content='Makefile&#x76F8;&#x95DC;&#x8A9E;&#x6CD5;&#x5B78;&#x7FD2;-&#x57FA;&#x790E;&#x8A9E;&#x6CD5;' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='https://blog.allengaodev.com/posts/gnu-makefile' />

  <link rel="icon" href='/favicon.svg'>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/scss/clean-blog-min.css' rel="stylesheet">
  <script async src='/vendor/quicklink/js/quicklink.umd.js' onload="quicklink.listen();"></script>
  <script async src='/vendor/prismjs/js/prism-core.min.js'></script>
  <script async src='/vendor/prismjs/js/prism-autoloader.min.js'></script>
  <link href='/vendor/prismjs/css/prism.min.css' rel="stylesheet" media="print" onload="this.media='all'">

  


  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/'>Gao.Dev</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/tags">Tags</a>
  </li>

      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  <header class="masthead no-image">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            <a style="color:white" href='https://blog.allengaodev.com/posts/gnu-makefile'>Makefile&#x76F8;&#x95DC;&#x8A9E;&#x6CD5;&#x5B78;&#x7FD2;-&#x57FA;&#x790E;&#x8A9E;&#x6CD5;</a>
              <span class="subheading">&#x4F7F;&#x7528; Makefile &#x81EA;&#x52D5;&#x5316;&#x7DE8;&#x8B6F;&#x548C;&#x90E8;&#x7F72;-&#x5B78;&#x7FD2;&#x539F;&#x7406;&#x8207;&#x6D41;&#x7A0B;</span>
          </h1>
            <div class="meta">Published on Wednesday, February 15, 2023</div>
              <div class="mt-3">
                  <a href="/tags/linux" class="badge text-bg-light"> Linux</a>
              </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <h2 id="makefile">Makefile</h2>
<p>Makefile主要應用在Linux與Mac環境之中，通常在大型專案之中用來編譯C或C++，因為Makefile能夠判斷在一個專案中有哪些依賴的檔案需要重新編譯，哪些檔案可以忽略不再編譯</p>
<p>此外Make命令在Linux個發布版本與Mac都有內建，所以Make在距離第一版發布多年之後還是廣泛的被開發者使用</p>
<p>本文章的範例將使用play with docker建立的Linux環境，詳細可參考<a href="https://blog.allengaodev.com/posts/dca-prepareguide" target="_blank">Docker Certified Associate(DCA)認證考試學習-準備環境</a></p>
<p>文章內容參考自<a href="https://makefiletutorial.com/" target="_blank">makefile-cookbook</a></p>
<p>首先建立我們的測試環境，並建立以下檔案</p>
<pre><code class="language-text">mkdir hello-world &amp;&amp; cd $_
vi Makefile
</code></pre>
<p>在 Makefile 輸入以下內容</p>
<pre><code class="language-text">hello:
	echo &quot;Hello, World&quot;
</code></pre>
<p>最後在終端機輸入<code>make</code>命令</p>
<pre><code class="language-text">[node1] (local) root&#64;192.168.0.18 ~/hello-world
$ make
echo &quot;Hello, World&quot;
Hello, World
</code></pre>
<h2 id="makefile-syntax">Makefile Syntax</h2>
<p>首先我們先了解一下Makefile的語法:</p>
<pre><code class="language-text">targets: prerequisites
	command
	command
	command
</code></pre>
<ul>
<li>targets 就像是dotnet中Method的名稱，它的作用範圍內可以包含多個命令，輸入完名稱之後需要使用<code>: </code>隔開</li>
<li>command 為運作的命令，注意這邊在輸入命令需要用一個<code>TAB</code>開頭，不可以用空格</li>
<li>prerequisites 為前置需求，在運作這個target之前要先運作，指定的target</li>
</ul>
<p>以上就是make的最基礎語法，首先先看一下先前Makefile的內容:<br />
第一行<code>hello:</code>為targets<br />
第二行<code>	echo &quot;Hello, World&quot;</code>command<br />
此範例沒有前置需求</p>
<p>那麼我們可以更進一步修改Makefile的內容</p>
<pre><code class="language-text">hello: hello-second
	echo &quot;Hello, World&quot;
hello-second:
	echo &quot;Hello, World second&quot;
</code></pre>
<p>這邊我建立了一個新的target <code>hello-second</code>，並且在target <code>hello</code>新增一個之前的前置需求，要求在運行<code>hello</code>之前需要先執行<code>hello-second</code></p>
<pre><code class="language-text">[node1] (local) root&#64;192.168.0.18 ~/hello-world
$ make
echo &quot;Hello, World second&quot;
Hello, World second
echo &quot;Hello, World&quot;
Hello, World
</code></pre>
<hr />
<h2 id="makefile-sample">Makefile Sample</h2>
<p>接下來看另一個範例，這邊會將docker的範例程式clone下來，再透過Makefile將流程整合在一起
程式來自docker範例程式<a href="https://github.com/docker-library/hello-world" target="_blank">github</a></p>
<p>新增或修改Makefile添加以下內容</p>
<pre><code class="language-text">all: docker-run clean

docker-run: docker-build
	docker run --name myhello hello-world
docker-build: file-copy
	docker build -t hello-world .
file-copy: git-pull
	cp hello-world/amd64/hello-world/hello .
git-pull: 
	git clone https://github.com/docker-library/hello-world

clean:
	rm -rf hello*
</code></pre>
<p>這邊如果有多個targets，一般都是使用all作為預設執行的target</p>
<p>再新增一個Dockerfile添加以下內容</p>
<pre><code class="language-text">vi Dockerfile
</code></pre>
<pre><code>FROM scratch
COPY hello /
CMD [&quot;/hello&quot;]
</code></pre>
<p>最後在終端機輸入<code>make</code></p>
<pre><code class="language-text">[node1] (local) root&#64;192.168.0.28 ~
$ make
git clone https://github.com/docker-library/hello-world
Cloning into 'hello-world'...
remote: Enumerating objects: 755, done.
remote: Counting objects: 100% (97/97), done.
remote: Compressing objects: 100% (59/59), done.
remote: Total 755 (delta 33), reused 79 (delta 22), pack-reused 658
Receiving objects: 100% (755/755), 574.50 KiB | 3.23 MiB/s, done.
Resolving deltas: 100% (313/313), done.
cp hello-world/amd64/hello-world/hello .
docker build -t hello-world .
Sending build context to Docker daemon  889.9kB
Step 1/3 : FROM scratch
 ---&gt; 
Step 2/3 : COPY hello /
 ---&gt; 22851d3f8c16
Step 3/3 : CMD [&quot;/hello&quot;]
 ---&gt; Running in 2a147ee248d2
Removing intermediate container 2a147ee248d2
 ---&gt; 37873ba92f23
Successfully built 37873ba92f23
Successfully tagged hello-world:latest
docker run --name myhello hello-world

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

rm -rf hello*
</code></pre>
<hr />
<h2 id="summary">Summary</h2>
<p>從今天的測試中可以得知，Makefile除了可以編譯大型程式之外，也可以拿來做一些基礎的流程控制<br />
有了Makefile之後，可以省下一些力氣背不同的指令，像在此處只需要記住一個指令<code>make</code>即可完成許多事<br />
而且只要專案有提供Makefile，都可以快速執行作者想要提供給我們的功能，非常方便。</p>


        

      </div>
    </div>
  <div id="comments-container" class="row">
    <!--<div class="likecoin-embed likecoin-button" data-liker-id="allengaodev" data-href='https://blog.allengaodev.com/posts/gnu-makefile'></div>
 <script src="https://static.like.co/sdk/v1/button.js"></script> -->

<script src="https://giscus.app/client.js"
        data-repo='allengaodev/allengaodev.github.io'
        data-repo-id='R_kgDOI6sF8g'
        data-category-id='DIC_kwDOI6sF8s4CUbuw'
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

  </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
          <p class="text-center small text-muted">Originally published at <a href='https://blog.allengaodev.com'> blog.allengaodev.com</a>.</p>
          <br />
        <p class="copyright">&#xA9; Allen Gao 2023</p>

      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script async src='/vendor/bootstrap/js/bootstrap.bundle.min1.js'></script>
  <script async src='/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  

  

</body>

</html>
